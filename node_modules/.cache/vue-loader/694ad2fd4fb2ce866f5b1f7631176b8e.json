{"remainingRequest":"/home/tal/development/vue-scaffold/node_modules/vue-loader/lib/index.js??vue-loader-options!/home/tal/development/vue-scaffold/src/views/ChatRoom.vue?vue&type=script&lang=js&","dependencies":[{"path":"/home/tal/development/vue-scaffold/src/views/ChatRoom.vue","mtime":1599666782860},{"path":"/home/tal/development/vue-scaffold/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/tal/development/vue-scaffold/node_modules/babel-loader/lib/index.js","mtime":499162500000},{"path":"/home/tal/development/vue-scaffold/node_modules/cache-loader/dist/cjs.js","mtime":499162500000},{"path":"/home/tal/development/vue-scaffold/node_modules/vue-loader/lib/index.js","mtime":499162500000}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7IG1hcEdldHRlcnMgfSBmcm9tICJ2dWV4IjsKY29uc3QgYXhpb3MgPSByZXF1aXJlKCJheGlvcyIpOwppbXBvcnQgc3RvcmUgZnJvbSAiLi4vc3RvcmUiOwoKZXhwb3J0IGRlZmF1bHQgewogIG5hbWU6ICJDaGF0Um9vbSIsCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIG1lc3NhZ2U6ICIiLAogICAgICByb29tTnVtOiB0aGlzLiRyb3V0ZXIuY3VycmVudFJvdXRlLnBhcmFtcy5yb29tSWQsCiAgICAgIHVzZXJzSW5Sb29tOiBbXSwKICAgICAgdGltZW91dElkczogW10sCiAgICB9OwogIH0sCiAgYmVmb3JlRGVzdHJveSgpIHsKICAgIHRoaXMua2lsbFRpbWVvdXRzKCk7CiAgfSwKICBtb3VudGVkKCkgewogICAgdGhpcy5raWxsVGltZW91dHMoKTsKICAgIHRoaXMucG9sbCh0aGlzLmdldENoYXRUZXh0KTsKICAgIHRoaXMucG9sbCh0aGlzLmdldFVzZXJMaXN0KTsKICAgIHRoaXMucG9sbCh0aGlzLmdldEFsbFVzZXJzKTsKICB9LAogIG1ldGhvZHM6IHsKICAgIHBvbGw6IGZ1bmN0aW9uIChjYikgewogICAgICBsZXQgaWQgPSBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICBjYigpCiAgICAgICAgICAudGhlbih0aGlzLnBvbGwoY2IpKQogICAgICAgICAgLmNhdGNoKCgpID0+IHsKICAgICAgICAgICAgY29uc29sZS5lcnJvcigic29tdGhpbmcgd2VudCB3cm9uZy4gcGxlYXNlIHRyeSBhZ2FpbiBsYXRlciIpOwogICAgICAgICAgfSk7CiAgICAgIH0sIDUwMCk7CiAgICAgIHRoaXMudGltZW91dElkcy5wdXNoKGlkKTsKICAgIH0sCiAgICBraWxsVGltZW91dHMoKSB7CiAgICAgIHRoaXMudGltZW91dElkcy5mb3JFYWNoKChpZCkgPT4gewogICAgICAgIGNsZWFyVGltZW91dChpZCk7CiAgICAgIH0pOwogICAgfSwKICAgIHNjcm9sbFRvRW5kOiBmdW5jdGlvbiAoKSB7CiAgICAgIHZhciBjb250YWluZXIgPSB0aGlzLiRlbC5xdWVyeVNlbGVjdG9yKCIjbGlzdE9mVGV4dCIpOwogICAgICBjb250YWluZXIuc2Nyb2xsVG9wID0gY29udGFpbmVyLnNjcm9sbEhlaWdodDsKICAgIH0sCiAgICBvblN1Ym1pdCgpIHsKICAgICAgaWYgKHRoaXMubWVzc2FnZSAhPT0gIiIpIHsKICAgICAgICByZXR1cm4gYXhpb3MKICAgICAgICAgIC5wb3N0KGAvcm9vbXMvJHt0aGlzLnJvb21OdW19L3RleHRgLCB7CiAgICAgICAgICAgIHRleHQ6IHRoaXMubWVzc2FnZSwKICAgICAgICAgICAgdXNlcklkOiB0aGlzLmxvZ2dlZGluVXNlci5pZCwKICAgICAgICAgIH0pCiAgICAgICAgICAudGhlbigoKSA9PiB7CiAgICAgICAgICAgIHRoaXMuZ2V0Q2hhdFRleHQoKTsKICAgICAgICAgIH0pCiAgICAgICAgICAuY2F0Y2goZnVuY3Rpb24gKGVycm9yKSB7CiAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgICAgfSk7CiAgICAgIH0KICAgIH0sCiAgICBnZXRDaGF0VGV4dCgpIHsKICAgICAgcmV0dXJuIGF4aW9zCiAgICAgICAgLmdldChgL3Jvb21zLyR7dGhpcy5yb29tTnVtfS90ZXh0YCkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIGxldCBySWQgPSB0aGlzLiRyb3V0ZXIuY3VycmVudFJvdXRlLnBhcmFtcy5yb29tSWQ7CiAgICAgICAgICBsZXQgY2hhdERhdGEgPSBbXTsKICAgICAgICAgIGNoYXREYXRhW3JJZF0gPSByZXNwb25zZS5kYXRhLnRleHQ7CiAgICAgICAgICBzdG9yZS5kaXNwYXRjaCgicm9vbXMvc2V0Q2hhdERhdGEiLCBjaGF0RGF0YSk7CiAgICAgICAgICB0aGlzLiRuZXh0VGljayhmdW5jdGlvbiAoKSB7CiAgICAgICAgICAgIHRoaXMuc2Nyb2xsVG9FbmQoKTsKICAgICAgICAgIH0pOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgfSk7CiAgICB9LAogICAgZ2V0VXNlckxpc3QoKSB7CiAgICAgIHJldHVybiBheGlvcwogICAgICAgIC5nZXQoYC9yb29tcy8ke3RoaXMucm9vbU51bX0vdXNlcnNgKQogICAgICAgIC50aGVuKChyZXNwb25zZSkgPT4gewogICAgICAgICAgdGhpcy51c2Vyc0luUm9vbSA9IG5ldyBTZXQocmVzcG9uc2UuZGF0YS51c2Vycyk7CiAgICAgICAgICBzdG9yZS5kaXNwYXRjaCgicm9vbXMvc2V0VXNlcnMiLCByZXNwb25zZS5kYXRhLnVzZXJzKTsKICAgICAgICB9KQogICAgICAgIC5jYXRjaChmdW5jdGlvbiAoZXJyb3IpIHsKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoZXJyb3IpOwogICAgICAgIH0pOwogICAgfSwKCiAgICBnZXRBbGxVc2VycygpIHsKICAgICAgcmV0dXJuIGF4aW9zCiAgICAgICAgLmdldChgL3VzZXJzYCkKICAgICAgICAudGhlbigocmVzcG9uc2UpID0+IHsKICAgICAgICAgIHN0b3JlLmRpc3BhdGNoKCJyb29tcy9zZXRBbGxVc2VycyIsIHJlc3BvbnNlLmRhdGEpOwogICAgICAgIH0pCiAgICAgICAgLmNhdGNoKGZ1bmN0aW9uIChlcnJvcikgewogICAgICAgICAgY29uc29sZS5lcnJvcihlcnJvcik7CiAgICAgICAgfSk7CiAgICB9LAogIH0sCiAgY29tcHV0ZWQ6IHsKICAgIC4uLm1hcEdldHRlcnMoewogICAgICBjaGF0RGF0YTogInJvb21zL2NoYXREYXRhIiwKICAgICAgdXNlcnNMaXN0OiAicm9vbXMvdXNlcnNMaXN0IiwKICAgICAgYWxsVXNlcnNMaXN0OiAicm9vbXMvYWxsVXNlcnNMaXN0IiwKICAgICAgbG9nZ2VkaW5Vc2VyOiAicm9vbXMvbG9nZ2VkaW5Vc2VyIiwKICAgIH0pLAogIH0sCn07Cg=="},{"version":3,"sources":["ChatRoom.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AA2DA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"ChatRoom.vue","sourceRoot":"src/views","sourcesContent":["<template>\n  <div class=\"chatRoom\">\n    <v-navigation-drawer :permanent=\"true\" absolute dark fixed :width=\"150\">\n      <v-list dense nav>\n        <v-list-item two-line>\n          <v-list-item-content>\n            <v-list-item-title></v-list-item-title>\n          </v-list-item-content>\n        </v-list-item>\n        <v-list-item-subtitle>users</v-list-item-subtitle>\n        <v-divider></v-divider>\n        <v-list-item v-for=\"item in usersInRoom\" :key=\"item.id\" link>\n          <v-list-item-content v-if=\"allUsersList[item]\">\n            <v-list-item-title>{{ allUsersList[item].name }}</v-list-item-title>\n          </v-list-item-content>\n        </v-list-item>\n      </v-list>\n    </v-navigation-drawer>\n    <v-list>\n      <v-list-item-group>\n        <v-list id=\"listOfText\" class=\"overflow-y-auto\" style=\"max-height: 85vh;\" two-line>\n          <template v-for=\"(item, index) in chatData[this.$router.currentRoute.params.roomId]\">\n            <v-list-item :key=\"index\">\n              <v-list-item-avatar>\n                <img src=\"@/assets/puppy.jpg\" />\n              </v-list-item-avatar>\n              <v-list-item-content v-if=\"allUsersList[item.userId]\">\n                <v-list-item-title v-html=\"allUsersList[item.userId].name\"></v-list-item-title>\n                <v-list-item-subtitle v-html=\"item.text\"></v-list-item-subtitle>\n              </v-list-item-content>\n            </v-list-item>\n          </template>\n        </v-list>\n      </v-list-item-group>\n    </v-list>\n\n    <v-footer style=\"height: 10vh;\" dark fixed>\n      <v-row justify=\"center\" no-gutters>\n        <form @submit.prevent=\"onSubmit\">\n          <v-text-field\n            v-model=\"message\"\n            style=\" display: inline-block;\"\n            label=\"Message\"\n            on:submit.prevent=\"onSubmit\"\n          ></v-text-field>\n          <v-btn\n            type=\"submit\"\n            class=\"ma-2\"\n            style=\" display: inline-block;\"\n            outlined\n            color=\"white\"\n          >Send</v-btn>\n        </form>\n      </v-row>\n    </v-footer>\n  </div>\n</template>\n\n<script>\nimport { mapGetters } from \"vuex\";\nconst axios = require(\"axios\");\nimport store from \"../store\";\n\nexport default {\n  name: \"ChatRoom\",\n  data() {\n    return {\n      message: \"\",\n      roomNum: this.$router.currentRoute.params.roomId,\n      usersInRoom: [],\n      timeoutIds: [],\n    };\n  },\n  beforeDestroy() {\n    this.killTimeouts();\n  },\n  mounted() {\n    this.killTimeouts();\n    this.poll(this.getChatText);\n    this.poll(this.getUserList);\n    this.poll(this.getAllUsers);\n  },\n  methods: {\n    poll: function (cb) {\n      let id = setTimeout(() => {\n        cb()\n          .then(this.poll(cb))\n          .catch(() => {\n            console.error(\"somthing went wrong. please try again later\");\n          });\n      }, 500);\n      this.timeoutIds.push(id);\n    },\n    killTimeouts() {\n      this.timeoutIds.forEach((id) => {\n        clearTimeout(id);\n      });\n    },\n    scrollToEnd: function () {\n      var container = this.$el.querySelector(\"#listOfText\");\n      container.scrollTop = container.scrollHeight;\n    },\n    onSubmit() {\n      if (this.message !== \"\") {\n        return axios\n          .post(`/rooms/${this.roomNum}/text`, {\n            text: this.message,\n            userId: this.loggedinUser.id,\n          })\n          .then(() => {\n            this.getChatText();\n          })\n          .catch(function (error) {\n            console.error(error);\n          });\n      }\n    },\n    getChatText() {\n      return axios\n        .get(`/rooms/${this.roomNum}/text`)\n        .then((response) => {\n          let rId = this.$router.currentRoute.params.roomId;\n          let chatData = [];\n          chatData[rId] = response.data.text;\n          store.dispatch(\"rooms/setChatData\", chatData);\n          this.$nextTick(function () {\n            this.scrollToEnd();\n          });\n        })\n        .catch(function (error) {\n          console.error(error);\n        });\n    },\n    getUserList() {\n      return axios\n        .get(`/rooms/${this.roomNum}/users`)\n        .then((response) => {\n          this.usersInRoom = new Set(response.data.users);\n          store.dispatch(\"rooms/setUsers\", response.data.users);\n        })\n        .catch(function (error) {\n          console.error(error);\n        });\n    },\n\n    getAllUsers() {\n      return axios\n        .get(`/users`)\n        .then((response) => {\n          store.dispatch(\"rooms/setAllUsers\", response.data);\n        })\n        .catch(function (error) {\n          console.error(error);\n        });\n    },\n  },\n  computed: {\n    ...mapGetters({\n      chatData: \"rooms/chatData\",\n      usersList: \"rooms/usersList\",\n      allUsersList: \"rooms/allUsersList\",\n      loggedinUser: \"rooms/loggedinUser\",\n    }),\n  },\n};\n</script>\n\n<style scoped>\n.chatRoom {\n  margin-left: 150px;\n  height: 90vh;\n}\n</style>\n"]}]}